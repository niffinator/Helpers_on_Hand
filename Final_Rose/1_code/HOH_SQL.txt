DROP DATABASE IF EXISTS helpers_on_hand;

CREATE DATABASE IF NOT EXISTS helpers_on_hand;

DROP USER IF EXISTS 'manager'@'localhost';

CREATE USER 'manager'@'localhost' IDENTIFIED BY 'hohManager';

GRANT SELECT ,
	INSERT ,
	UPDATE ,
	DELETE ,
	CREATE ,
	FILE
ON *.*
TO 'manager'@'localhost' IDENTIFIED BY 'hohManager'
WITH
	MAX_QUERIES_PER_HOUR 0
	MAX_CONNECTIONS_PER_HOUR 0
	MAX_UPDATES_PER_HOUR 0
	MAX_USER_CONNECTIONS 0;

USE helpers_on_hand;

CREATE TABLE IF NOT EXISTS role
(
	roleid int(1) NOT NULL,
	rolename varchar(8) DEFAULT NULL,
	PRIMARY KEY (roleid)
);

CREATE TABLE IF NOT EXISTS person
(
	personid int(4) NOT NULL,
	fname varchar(50) DEFAULT NULL,
	lname varchar(50) DEFAULT NULL,
	midname varchar(50) DEFAULT NULL,
	phone varchar(20) DEFAULT NULL,
	email varchar(100) DEFAULT NULL,
	address1 varchar(100) DEFAULT NULL,
	address2 varchar(100) DEFAULT NULL,
	city varchar(50) DEFAULT NULL,
	state varchar(30) DEFAULT NULL,
	zip varchar(10) DEFAULT NULL,
	notes varchar(200) DEFAULT NULL,
	background varchar(7) DEFAULT NULL,
	role int(1) DEFAULT NULL,
	PRIMARY KEY (personid),
	FOREIGN KEY (role) REFERENCES role(roleid)
);

CREATE TABLE IF NOT EXISTS chore
(
	choreid int(2) NOT NULL,
	chorename varchar(50) DEFAULT NULL,
	choredesc varchar(200) DEFAULT NULL,
	noofstaff int(2) DEFAULT NULL,
	PRIMARY KEY (choreid)
);

CREATE TABLE IF NOT EXISTS status
(
	statusid int(1) NOT NULL,
	statusdesc varchar(20) DEFAULT NULL,
	PRIMARY KEY (statusid)
);

CREATE TABLE IF NOT EXISTS handraise
(
	handraiseid int(10) NOT NULL,
	helperid int(4) DEFAULT NULL,
	availdate date DEFAULT NULL,
	availtime time DEFAULT NULL,
	availchores int(2) NOT NULL,
	PRIMARY KEY (handraiseid),
	FOREIGN KEY (helperid) REFERENCES person(personid) ON DELETE CASCADE,
	FOREIGN KEY (availchores) REFERENCES chore(choreid) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS request
(
	requestid int(10) NOT NULL,
	reqclientid int(4) DEFAULT NULL,
	reqdate date DEFAULT NULL,
	reqtime time DEFAULT NULL,
	reqchoreid int(2) DEFAULT NULL,
	reqstatusid int(1) DEFAULT NULL,
	PRIMARY KEY (requestid),
	FOREIGN KEY (reqclientid) REFERENCES person(personid) ON DELETE CASCADE,
	FOREIGN KEY (reqchoreid) REFERENCES chore(choreid) ON DELETE CASCADE,
	FOREIGN KEY (reqstatusid) REFERENCES status(statusid) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS transaction
(
	transactionid int(10) NOT NULL,
	requestid int(10) DEFAULT NULL,
	reqdate date DEFAULT NULL,
	reqtime time DEFAULT NULL,
	clientid int(4) DEFAULT NULL,
	helperid1 int(4) DEFAULT NULL,
	helperid2 int(4) DEFAULT NULL,
	managerid int(4) DEFAULT NULL,
	schdate date DEFAULT NULL,
	schtime time DEFAULT NULL,
	transtatusid int(1) DEFAULT NULL,
	PRIMARY KEY (transactionid),
	FOREIGN KEY (requestid) REFERENCES request(requestid) ON DELETE CASCADE,
	FOREIGN KEY (clientid) REFERENCES person(personid) ON DELETE CASCADE,
	FOREIGN KEY (helperid1) REFERENCES person(personid) ON DELETE CASCADE,
	FOREIGN KEY (helperid2) REFERENCES person(personid) ON DELETE CASCADE,
	FOREIGN KEY (managerid) REFERENCES person(personid) ON DELETE CASCADE,
	FOREIGN KEY (transtatusid) REFERENCES status(statusid) ON DELETE CASCADE
);

INSERT INTO role
(
	roleid,
	rolename
)
VALUES
	(1, 'client'),
	(2, 'helper'),
	(3, 'manager');


INSERT INTO chore
(
	choreid,
	chorename,
	choredesc,
	noofstaff
)
VALUES
	(01,'Dishwashing','Wash dishes', 1),
	(02,'Laundry','wash, dry, fold, iron, put away up to 2 loads', 1),
	(03,'Yardwork','raking leaves, mowing lawn, general maintenance up to 2 hours', 2),
	(04,'Errand','to be determined, up to two hours', 1),
	(05,'Bills', 'balance checkbook, pay bills',1);

INSERT INTO status
(
	statusid,
	statusdesc
)
VALUES
	(1, 'submitted'),
	(2, 'assigned'),
	(3, 'scheduled'),
	(4, 'under review'),
	(5, 'cancelled'),
	(6, 'completed');

INSERT INTO Person
(
	personid,
	fname,
	lname,
	midname,
	phone,
	email,
	address1,
	address2,
	city,
	state,
	zip,
	notes,
	background,
	role
)
VALUES
	(1001, 'Esther', 'Munson', 'Joy', '5551231234', 'emj@here.com', '123 My Street', '', 'This Town', 'FL', '32927', 'Allergic to cats',1,3),
	(1002, 'Mahala', 'Jenkins', 'Jorge', '5552232233', 'mjj@here.com', '123 Your Street', '', 'This Town', 'FL', '32927', 'Early Riser',1,2),
	(1003, 'Jerrica', 'Aang', 'Major', '5553334444', 'jam@here.com', '456 Our Lane', '', 'That Town', 'IN', '47401', 'Wheelchair user',1,1),
	(1004, 'Marcus', 'Zuko', 'Minor', '5554445555', 'mzm@here.com', '456 Hershey Parkway', '', 'That Town', 'IN', '47401', '',1,2),
	(1005, 'Jonathan', 'Mister', 'Theo', '5555556666', 'jmt3@here.com', '789 Magic Drive', '', 'Our Town', 'PA', '19874', '',0,1);
	
